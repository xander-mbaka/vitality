define(["app_admin"],function(e){e.module("Entities",function(e,n,r,t,o){r.emulateJSON=!0,e.Journal=r.Model.extend({urlRoot:"ecomadmin/presentation/journal"}),e.JournalCollection=r.Collection.extend({url:"/ecomadmin/presentation/journals",model:e.Journal}),e.Issue=r.Model.extend({urlRoot:"ecomadmin/presentation/journal"}),e.IssueCollection=r.Collection.extend({url:"/ecomadmin/presentation/journals",model:e.Issue}),e.Article=r.Model.extend({urlRoot:"ecomadmin/presentation/journal"}),e.ArticleCollection=r.Collection.extend({url:"/ecomadmin/presentation/journals",model:e.Article}),e.Indicator=r.Model.extend({urlRoot:"ecomadmin/presentation/trend"}),e.IndicatorCollection=r.Collection.extend({url:"/ecomadmin/presentation/trends",model:e.Indicator}),e.Blog=r.Model.extend({urlRoot:"ecomadmin/presentation/blog"}),e.BlogCollection=r.Collection.extend({url:"/ecomadmin/presentation/blogs",model:e.Blog}),e.BlogComment=r.Model.extend({urlRoot:"ecomadmin/presentation/blog"}),e.BlogCommentCollection=r.Collection.extend({url:"/ecomadmin/presentation/blogs",model:e.BlogComment}),e.Model=r.Model.extend({urlRoot:"ecomadmin/presentation/blog"}),e.Collection=r.Collection.extend({url:"/ecomadmin/presentation/blogs",model:e.Model});var i,s=function(n){var r=new e.Collection(n);return r.models},l=function(){var n=new e.JournalCollection([{name:"American Economic Review",cover_img_url:"./assets/journalcovers/american econ review.jpg"},{name:"American Journal of Agricultural Economics",cover_img_url:"./assets/journalcovers/American Journal of Agricultural Econ.jpg"},{name:"Applied Economics",cover_img_url:"./assets/journalcovers/applied economics.jpg"},{name:"Ecological Economics",cover_img_url:"./assets/journalcovers/ecological econo.jpg"},{name:"Economic Journal",cover_img_url:"./assets/journalcovers/econ journal.jpg"},{name:"Economic Letters",cover_img_url:"./assets/journalcovers/econ letters.jpg"},{name:"Energy Economics",cover_img_url:"./assets/journalcovers/energy econ.jpg"},{name:"European Economic Review",cover_img_url:"./assets/journalcovers/european econ review.jpg"},{name:"Games & Economic Behavior",cover_img_url:"./assets/journalcovers/games and econ behaviour.jpg"},{name:"Health Economics",cover_img_url:"./assets/journalcovers/health econ.jpg"},{name:"Journal of Accounting & Economics",cover_img_url:"./assets/journalcovers/acc and econ.jpg"}]);return n.forEach(function(e){e.save()}),n.models},a=function(n,r,t){var o=new e.IssueCollection(n);return o.forEach(function(e){e.set("journal_id",r),e.set("journal_name",t)}),o.models},c=function(n){var r=new e.IssueCollection(n);return r.models},u=function(n){var r=new e.JournalCollection(n);return r.models},g=function(n){var r=new e.IndicatorCollection(n);return r.models},d=function(n){var r=new e.BlogCollection(n);return r.models},f=function(n){var r=new e.BlogCommentCollection(n);return r.models},m={getJournalEntities:function(){var n=new e.JournalCollection,r=o.Deferred();n.fetch({success:function(e){r.resolve(e)}});var t=r.promise();return o.when(t).done(function(e){0===e.length&&o.get("/ecomadmin/presentation/journals/?journals",function(n){if(0===n.length){var r=l();e.reset(r)}else{var r=u(JSON.parse(n));e.reset(r)}})}),n},getJournalIssues:function(n){var r=n.get("journal_id"),t=n.get("name"),i=new e.IssueCollection,s=o.Deferred();return o.when(o.get("/ecomadmin/presentation/journals/?issues&journalId="+r,function(e){var n=JSON.parse(e);if(0===n.length){var o=a(n,r,t);i.reset(o)}else{var o=a(n,r,t);i.reset(o)}})).done(function(){n.set("issues",i),s.resolve(n)}),s.promise()},getIssueArticles:function(n){var r=n.get("journal_id"),t=n.get("issue"),i=new e.ArticleCollection,s=o.Deferred();return o.when(o.get("/ecomadmin/presentation/journals/?issue="+t+"&journalId="+r,function(e){var n=JSON.parse(e);if(0===n.length){var t=c(n,r);i.reset(t)}else{var t=c(n,r);i.reset(t)}})).done(function(){n.set("articles",i),s.resolve(n)}),s.promise()},getIndicatorEntities:function(){var n=new e.IndicatorCollection,r=o.Deferred();n.fetch({success:function(e){r.resolve(e)}});var t=r.promise();return o.when(t).done(function(e){0===e.length&&o.get("/ecomadmin/presentation/trends",function(n){if(0===n.length){var r=initializeIndicator();e.reset(r)}else{alert(n);var r=g(JSON.parse(n));e.reset(r)}})}),n},getBlogEntities:function(){i=new e.BlogCollection;var n=o.Deferred();return o.when(o.get("/ecomadmin/presentation/blogs",function(e){var n=d(JSON.parse(e));i.reset(n)})).done(function(){n.resolve(i)}),n.promise()},getSubscriberEntities:function(){var n=new e.Collection,r=o.Deferred();return o.when(o.get("/ecomadmin/presentation/admin/?subscribers",function(e){var r=s(JSON.parse(e));n.reset(r)})).done(function(){r.resolve(n)}),r.promise()},getAdminEntities:function(){var n=new e.Collection,r=o.Deferred();return o.when(o.get("/ecomadmin/presentation/admin/?admins",function(e){var r=s(JSON.parse(e));n.reset(r)})).done(function(){r.resolve(n)}),r.promise()},searchSubscribers:function(n){var r=new e.Collection,t=o.Deferred();return o.when(o.get("/ecomadmin/presentation/admin/?searchSubscriber&name="+n,function(e){var n=s(JSON.parse(e));r.reset(n)})).done(function(){t.resolve(r)}),t.promise()},searchAdmins:function(n){var r=new e.Collection,t=o.Deferred();return o.when(o.get("/ecomadmin/presentation/admin/?searchAdmin&name="+n,function(e){var n=s(JSON.parse(e));r.reset(n)})).done(function(){t.resolve(r)}),t.promise()},filterSubscribers:function(n){var r=new e.Collection,t=o.Deferred();return o.when(o.get("/ecomadmin/presentation/admin/?filterSubscriber&key="+n,function(e){var n=s(JSON.parse(e));r.reset(n)})).done(function(){t.resolve(r)}),t.promise()},filterAdmins:function(n){var r=new e.Collection,t=o.Deferred();return o.when(o.get("/ecomadmin/presentation/admin/?filterAdmin&key="+n,function(e){var n=s(JSON.parse(e));r.reset(n)})).done(function(){t.resolve(r)}),t.promise()},getCategoryEntities:function(){categories=new e.Collection;var n=o.Deferred();return o.when(o.get("/ecomadmin/presentation/journals/?categories",function(e){var n=s(JSON.parse(e));categories.reset(n)})).done(function(){n.resolve(categories)}),n.promise()},getBlog:function(n){var r,t=new e.BlogCommentCollection,i=n.get("blog_id"),s=o.Deferred();return o.when(o.get("/ecomadmin/presentation/blogs/?blogId="+i,function(e){r=e}),o.get("/ecomadmin/presentation/blogs/?comments="+i,function(e){var n=f(JSON.parse(e));t.reset(n)})).done(function(){n.set("full",r),n.set("comments",t),s.resolve(n)}),s.promise()},getAccountDetails:function(){var n,r=o.Deferred();return o.when(o.get("/ecomadmin/presentation/admin/?adminDetails",function(r){n=new e.Model(JSON.parse(r))})).done(function(){r.resolve(n)}),r.promise()},getDashboardEntities:function(){var n,r=o.Deferred();return o.when(o.get("/ecomadmin/presentation/admin/?dashDetails",function(r){n=new e.Model(JSON.parse(r))})).done(function(){r.resolve(n)}),r.promise()},getJournalEntity:function(n){var r=new e.journal({id:n}),t=o.Deferred();return setTimeout(function(){r.fetch({success:function(e){t.resolve(e)},error:function(){t.resolve(void 0)}})},2e3),t.promise()}};n.reqres.setHandler("load:entities",function(){m.loadEntities()}),n.reqres.setHandler("journal:entities",function(){return m.getJournalEntities()}),n.reqres.setHandler("category:entities",function(){return m.getCategoryEntities()}),n.reqres.setHandler("journal:issues",function(e){return m.getJournalIssues(e)}),n.reqres.setHandler("issue:articles",function(e){return m.getIssueArticles(e)}),n.reqres.setHandler("indicator:entities",function(){return m.getIndicatorEntities()}),n.reqres.setHandler("blog:entities",function(){return m.getBlogEntities()}),n.reqres.setHandler("blog:entity",function(e){return m.getBlog(e)}),n.reqres.setHandler("subscriber:entities",function(){return m.getSubscriberEntities()}),n.reqres.setHandler("subscribers:search",function(e){return m.searchSubscribers(e)}),n.reqres.setHandler("subscribers:filter",function(e){return m.filterSubscribers(e)}),n.reqres.setHandler("admin:entities",function(){return m.getAdminEntities()}),n.reqres.setHandler("admins:search",function(e){return m.searchAdmins(e)}),n.reqres.setHandler("admins:filter",function(e){return m.filterAdmins(e)}),n.reqres.setHandler("account:entities",function(){return m.getAccountDetails()}),n.reqres.setHandler("dashboard:entities",function(){return m.getDashboardEntities()}),n.reqres.setHandler("journal:entity",function(e){return m.getJournalEntity(e)}),n.reqres.setHandler("journal:entity:new",function(){return new e.Journal})})});